<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>Aeonforge Lite - Single File Prototype</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  html,body{height:100%;background:#0b0f1a}
  canvas{display:block;position:fixed;left:0;top:0;width:100%;height:100%}
  #hud{position:fixed;left:0;right:0;top:0;pointer-events:none}
  #topbar{display:flex;justify-content:space-between;padding:10px;color:#dfe9ff;text-shadow:0 1px 0 rgba(0,0,0,0.5);pointer-events:auto}
  #topbar button{pointer-events:auto;padding:6px 10px;border-radius:10px;border:0;background:linear-gradient(180deg,#2b2f46,#202433);color:#fff}
  #controls{position:fixed;left:0;right:0;bottom:6vh;display:flex;justify-content:space-between;padding:20px;pointer-events:none}
  #joystick{width:36vw;height:36vw;max-width:220px;max-height:220px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.06), rgba(255,255,255,0.02));margin-left:6vw;pointer-events:auto;touch-action:none}
  #buttons{pointer-events:auto;display:flex;flex-direction:column;align-items:flex-end;margin-right:6vw}
  .btn{padding:10px 14px;border-radius:14px;background:linear-gradient(180deg,#fffc,#eee3);border:0;margin-bottom:10px;box-shadow:0 6px 14px rgba(0,0,0,0.3);font-weight:700}
  .btn.big{font-size:18px;padding:18px 24px;border-radius:22px;background:linear-gradient(180deg,#ff6f3c,#ff4b1a);color:white}
  .skillRow{display:flex;gap:10px}
  .modal{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(2,6,15,0.7);display:flex;align-items:center;justify-content:center;pointer-events:auto}
  .modalContent{background:#0f1622;padding:18px;border-radius:14px;color:#dfe9ff;min-width:260px;max-width:720px;width:92%;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
  .hidden{display:none}
  #gearList{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
  .gearCard{background:linear-gradient(180deg,#111827,#0b1220);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);min-height:86px;display:flex;flex-direction:column;justify-content:space-between}
  .gearName{font-weight:700}
  .rarity{font-size:12px;padding:4px;border-radius:6px;display:inline-block;margin-top:6px}
  .rarity.common{background:#2b303a;color:#cfd8ff}
  .rarity.rare{background:#243e8a;color:#e0ecff}
  .rarity.epic{background:#582d8c;color:#f3e8ff}
  .rarity.legendary{background:linear-gradient(90deg,#ffb74d,#ff6f3c);color:#2a0b00}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="hud">
  <div id="topbar">
    <div id="score">Score: <span id="scoreVal">0</span></div>
    <div id="currency">Shards: <span id="shardsVal">0</span></div>
    <button id="invBtn">Inventory</button>
  </div>
  <div id="controls">
    <div id="joystick"></div>
    <div id="buttons">
      <button class="btn big" id="attackBtn">Attack</button>
      <div class="skillRow">
        <button class="btn" id="skill1">Skill 1</button>
        <button class="btn" id="skill2">Skill 2</button>
      </div>
    </div>
  </div>
</div>
<div id="inventoryModal" class="modal hidden">
  <div class="modalContent">
    <h2>Inventory</h2>
    <div id="gearList"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="closeInv" class="btn">Close</button>
      <button id="salvageAll" class="btn">Salvage All Commons</button>
    </div>
  </div>
</div>
<script>
// Compact game code (same as prototype)
(function(){
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
let W=innerWidth, H=innerHeight; canvas.width=W; canvas.height=H;
window.addEventListener('resize', ()=>{W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H;});
function rand(min,max){return Math.random()*(max-min)+min;} function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
const state={player:null,enemies:[],particles:[],loot:[],score:0,shards:0,gearOwned:[],time:0,lastSpawn:0,spawnInterval:1.2,running:true};
const WEIGHTS={common:0.6, rare:0.25, epic:0.09, legendary:0.05, mythic:0.01};
const GEAR_DB=[{id:'solflare',name:'Solflare',slot:'weapon',rarity:'legendary',str:8,overlay:'solflare',persistent:'solflare_persist',signature:{stacks:4,mult:2.0,procVfx:'solflare_proc'}},{id:'glacier',name:"Glacier's Bite",slot:'weapon',rarity:'legendary',str:6,overlay:'glacier',persistent:'glacier_persist',signature:{stacks:3,mult:1.6,procVfx:'glacier_proc'}},{id:'tempest',name:'Tempest Wailer',slot:'weapon',rarity:'epic',str:5,overlay:'tempest',persistent:null,signature:{stacks:0,mult:0,procVfx:null}},{id:'common_blade',name:'Rusty Blade',slot:'weapon',rarity:'common',str:2,overlay:null,persistent:null,signature:null}];
const COLORS={bgTop:'#071428',bgBot:'#08111f',player:'#ffd27f',enemy:'#f39b9b'};
let input={jx:0,jy:0,attacking:false};
const joystickEl=document.getElementById('joystick'), attackBtn=document.getElementById('attackBtn'), invBtn=document.getElementById('invBtn'), inventoryModal=document.getElementById('inventoryModal'), gearListEl=document.getElementById('gearList'), shardsVal=document.getElementById('shardsVal'), scoreVal=document.getElementById('scoreVal'), closeInv=document.getElementById('closeInv'), salvageAll=document.getElementById('salvageAll');
let activeTouch=null, joyCx=0, joyCy=0;
function onTouchStart(e){ for(const t of e.changedTouches){ const x=t.clientX; if(x < W*0.55 && activeTouch==null){ activeTouch=t.identifier; joyCx=x; joyCy=t.clientY; input.jx=0; input.jy=0; } } }
function onTouchMove(e){ for(const t of e.changedTouches){ if(t.identifier===activeTouch){ const dx=t.clientX - joyCx, dy=t.clientY - joyCy; const max=Math.min(W,H)*0.18; input.jx = clamp(dx/max,-1,1); input.jy = clamp(dy/max,-1,1); } } }
function onTouchEnd(e){ for(const t of e.changedTouches){ if(t.identifier===activeTouch){ activeTouch=null; input.jx=0; input.jy=0; } } }
window.addEventListener('touchstart', onTouchStart, {passive:false}); window.addEventListener('touchmove', onTouchMove, {passive:false}); window.addEventListener('touchend', onTouchEnd, {passive:false});
let mouseDown=false; window.addEventListener('mousedown', e=>{ if(e.clientX < W*0.55){ mouseDown=true; joyCx=e.clientX; joyCy=e.clientY; } }); window.addEventListener('mousemove', e=>{ if(mouseDown){ const dx=e.clientX-joyCx, dy=e.clientY-joyCy; const max=Math.min(W,H)*0.18; input.jx=clamp(dx/max,-1,1); input.jy=clamp(dy/max,-1,1); } }); window.addEventListener('mouseup', e=>{ mouseDown=false; input.jx=0; input.jy=0; });
attackBtn.addEventListener('touchstart', ()=>{ input.attacking=true; }); attackBtn.addEventListener('touchend', ()=>{ input.attacking=false; }); attackBtn.addEventListener('mousedown', ()=>{ input.attacking=true; }); attackBtn.addEventListener('mouseup', ()=>{ input.attacking=false; });
invBtn.addEventListener('click', ()=>{ openInventory(); }); closeInv.addEventListener('click', ()=>{ closeInventory(); }); salvageAll.addEventListener('click', ()=>{ salvageCommons(); });
function updateUI(){ shardsVal.textContent = state.shards; scoreVal.textContent = state.score; }
class Player{ constructor(){ this.x=W/2; this.y=H/2; this.radius=Math.min(W,H)*0.035; this.speed=160; this.hp=100; this.maxHp=100; this.weapon=null; this.procStacks=0; this.lastProc=0; this.glowTime=0;} equip(gear){ this.weapon=gear; this.procStacks=0; this.lastProc=0;} getDamage(){ let base=8; if(this.weapon && this.weapon.str) base+=this.weapon.str; return base;} move(dt){ if(Math.abs(input.jx)>0.04 || Math.abs(input.jy)>0.04){ const dx=input.jx; const dy=input.jy; const len=Math.hypot(dx,dy)||1; this.x += (dx/len)*this.speed*dt; this.y += (dy/len)*this.speed*dt; this.x = clamp(this.x, this.radius, W - this.radius); this.y = clamp(this.y, this.radius + 90, H - this.radius); } } attack(dt){ if(!input.attacking) return; const now = state.time; if(this.lastAttack && now - this.lastAttack < 0.4) return; this.lastAttack = now; const target = nearestEnemy(this.x,this.y, Math.min(W,H)*0.32); if(target){ spawnParticles(target.x,target.y, (this.weapon && this.weapon.rarity==='legendary')?5:3, '#ffdca8'); target.hp -= this.getDamage(); if(this.weapon && this.weapon.signature){ this.procStacks++; if(this.procStacks >= this.weapon.signature.stacks){ this.procStacks=0; doProc(target, this.weapon.signature); } } this.glowTime=0.24; if(target.hp <= 0){ target.die(); } } else { spawnParticles(this.x + (input.jx||0)*20, this.y + (input.jy||0)*20, 2, '#ffdca8'); } } }
class Enemy{ constructor(x,y,level=1){ this.x=x; this.y=y; this.radius=Math.min(W,H)*0.03; this.hp=20*level; this.maxHp=this.hp; this.level=level; this.speed=40+level*10; this.color='#f39b9b'; } update(dt){ const dx=state.player.x - this.x, dy=state.player.y - this.y; const d=Math.hypot(dx,dy)||1; this.x += (dx/d)*this.speed*dt; this.y += (dy/d)*this.speed*dt; this.x = clamp(this.x, this.radius, W - this.radius); this.y = clamp(this.y, this.radius + 90, H - this.radius); } die(){ spawnLoot(this.x,this.y); state.score += 10 * this.level; spawnParticles(this.x,this.y, 22, '#ffcfb3'); const i = state.enemies.indexOf(this); if(i>=0) state.enemies.splice(i,1); } }
function spawnParticles(x,y,count,color){ for(let i=0;i<count;i++){ state.particles.push({ x,y,vx:rand(-120,120), vy:rand(-160, -20), life:rand(0.3,0.9), maxLife:rand(0.5,1.2), col:color, r:rand(1,4) }); } }
class Loot{ constructor(x,y,gear){ this.x=x; this.y=y; this.t=0; this.gear=gear; this.pulse=0; } update(dt){ this.t += dt; this.pulse = Math.sin(this.t*6)*4; this.y -= dt * 6; const d = Math.hypot(state.player.x - this.x, state.player.y - this.y); if(d < state.player.radius + 18){ state.gearOwned.push(this.gear); const ownedCount = state.gearOwned.filter(g=>g.id===this.gear.id).length; if(ownedCount>1){ state.shards += Math.max(5, Math.floor(10 * (this.gear.rarity==='legendary'?3: this.gear.rarity==='epic'?2:1))); } this.x = -9999; this.y = -9999; updateUI(); } } }
function spawnLoot(x,y){ const r=Math.random(); let cum=0; let chosen='common'; for(const k of Object.keys(WEIGHTS)){ cum+=WEIGHTS[k]; if(r<=cum){ chosen=k; break; } } const pool = GEAR_DB.filter(g=>g.rarity===chosen); const gear = pool.length>0 ? JSON.parse(JSON.stringify(choose(pool))) : JSON.parse(JSON.stringify(choose(GEAR_DB))); state.loot.push(new Loot(x,y,gear)); }
function nearestEnemy(x,y,maxRange){ let best=null,bd=9999; for(const e of state.enemies){ const d=Math.hypot(e.x-x,e.y-y); if(d<bd && d<=maxRange){ bd=d; best=e; } } return best; }
function doProc(target,sig){ if(sig.procVfx==='solflare_proc'){ spawnParticles(target.x,target.y,40,'#ffb77a'); for(const e of state.enemies){ const d=Math.hypot(e.x-target.x, e.y-target.y); if(d<120){ e.hp -= 18; if(e.hp<=0) e.die(); } } } else if(sig.procVfx==='glacier_proc'){ spawnParticles(target.x,target.y,30,'#cfefff'); for(const e of state.enemies){ const d=Math.hypot(e.x-target.x, e.y-target.y); if(d<120){ e.speed *= 0.6; setTimeout(()=>{ e.speed /= 0.6; }, 1600); } } } state.shards += 2; updateUI(); }
function maybeSpawn(dt){ state.lastSpawn += dt; if(state.lastSpawn > state.spawnInterval){ state.lastSpawn = 0; const side=Math.floor(rand(0,4)); let x=0,y=0; if(side===0){ x=rand(0,W); y=-40; } if(side===1){ x=rand(0,W); y=H+40; } if(side===2){ x=-40; y=rand(0,H); } if(side===3){ x=W+40; y=rand(0,H); } state.enemies.push(new Enemy(x,y, Math.floor(rand(1,3)))); } }
function init(){ state.player=new Player(); state.player.equip(GEAR_DB[3]); state.enemies=[]; state.loot=[]; state.particles=[]; for(let i=0;i<3;i++) state.enemies.push(new Enemy(rand(100,W-100), rand(200,H-200), 1)); updateUI(); }
function update(dt){ if(!state.running) return; state.time += dt; state.player.move(dt); maybeSpawn(dt); for(const e of [...state.enemies]) e.update(dt); for(const l of [...state.loot]) l.update(dt); for(let i=state.particles.length-1;i>=0;i--){ const p=state.particles[i]; p.x+=p.vx*dt; p.y+=p.vy*dt; p.vy += 300*dt; p.life -= dt; if(p.life <=0) state.particles.splice(i,1); } state.player.attack(dt); for(const e of state.enemies){ const d = Math.hypot(e.x-state.player.x, e.y-state.player.y); if(d < e.radius + state.player.radius){ state.player.hp -= 8*dt; } } state.loot = state.loot.filter(l=>l.x>-9000); }
function draw(){ const g = ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#071428'); g.addColorStop(1,'#08111f'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H); ctx.save(); ctx.globalCompositeOperation='lighter'; for(const p of state.particles){ ctx.fillStyle=p.col; ctx.beginPath(); ctx.globalAlpha = clamp(p.life/p.maxLife,0,1); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); } ctx.globalAlpha=1; ctx.restore(); for(const e of state.enemies){ ctx.fillStyle='rgba(0,0,0,0.25)'; ctx.beginPath(); ctx.ellipse(e.x, e.y + e.radius*0.8, e.radius*1.2, e.radius*0.6,0,0,Math.PI*2); ctx.fill(); ctx.fillStyle=e.color; ctx.beginPath(); ctx.arc(e.x,e.y,e.radius,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#222'; ctx.fillRect(e.x - e.radius, e.y - e.radius - 12, e.radius*2, 6); ctx.fillStyle='#ff9999'; ctx.fillRect(e.x - e.radius, e.y - e.radius - 12, (e.hp/e.maxHp)*e.radius*2, 6); } for(const l of state.loot){ ctx.save(); ctx.beginPath(); ctx.fillStyle='#fff'; ctx.arc(l.x,l.y,10 + l.pulse,0,Math.PI*2); ctx.fill(); let col='#999'; if(l.gear.rarity==='legendary') col='#ffb46b'; else if(l.gear.rarity==='epic') col='#b88af2'; ctx.lineWidth=3; ctx.strokeStyle=col; ctx.stroke(); ctx.fillStyle='#fff'; ctx.font='11px system-ui'; ctx.fillText(l.gear.name, l.x+14, l.y+3); ctx.restore(); } const p=state.player; if(p.glowTime>0){ ctx.save(); const alpha = clamp(p.glowTime / 0.24,0,1); ctx.fillStyle='rgba(255,200,140,'+alpha*0.5+')'; ctx.beginPath(); ctx.arc(p.x,p.y,p.radius*1.6,0,Math.PI*2); ctx.fill(); ctx.restore(); p.glowTime -= 1/60; } if(p.weapon && p.weapon.persistent){ ctx.save(); if(p.weapon.rarity==='legendary'){ ctx.beginPath(); ctx.fillStyle='rgba(255,140,80,0.12)'; ctx.arc(p.x,p.y,p.radius*2.2,0,Math.PI*2); ctx.fill(); } ctx.restore(); } ctx.fillStyle=COLORS.player; ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill(); if(p.weapon && p.weapon.overlay){ ctx.save(); ctx.fillStyle = p.weapon.rarity==='legendary' ? '#ffb46b' : '#fff'; ctx.beginPath(); ctx.arc(p.x + p.radius*1.2, p.y, p.radius*0.6, 0, Math.PI*2); ctx.fill(); if(p.weapon.signature){ ctx.fillStyle='#fff'; ctx.font='10px system-ui'; ctx.fillText('*', p.x + p.radius*1.1, p.y+3); } ctx.restore(); } }
let lastTime = performance.now(); function gameLoop(now){ const dt = Math.min(0.05, (now - lastTime) / 1000); lastTime = now; update(dt); draw(); requestAnimationFrame(gameLoop); }
function openInventory(){ inventoryModal.classList.remove('hidden'); renderInventory(); } function closeInventory(){ inventoryModal.classList.add('hidden'); } function renderInventory(){ gearListEl.innerHTML=''; if(state.gearOwned.length===0){ gearListEl.innerHTML = '<div style=\"padding:12px;color:#9fb4ff\">No gear yet. Kill enemies to find drops.</div>'; return; } state.gearOwned.forEach((g,idx)=>{ const card=document.createElement('div'); card.className='gearCard'; const name=document.createElement('div'); name.className='gearName'; name.textContent=g.name; const r=document.createElement('div'); r.className='rarity '+g.rarity; r.textContent=g.rarity.toUpperCase(); const btns=document.createElement('div'); const equip=document.createElement('button'); equip.className='btn'; equip.textContent='Equip'; equip.onclick=()=>{ state.player.equip(g); closeInventory(); }; const sell=document.createElement('button'); sell.className='btn'; sell.textContent='Sell'; sell.onclick=()=>{ state.shards += (g.rarity==='legendary'?50:10); state.gearOwned.splice(idx,1); renderInventory(); updateUI(); }; btns.appendChild(equip); btns.appendChild(sell); card.appendChild(name); card.appendChild(r); card.appendChild(btns); gearListEl.appendChild(card); }); }
function salvageCommons(){ let removed=0; for(let i=state.gearOwned.length-1;i>=0;i--){ if(state.gearOwned[i].rarity==='common'){ state.gearOwned.splice(i,1); state.shards+=5; removed++; } } renderInventory(); updateUI(); alert('Salvaged ' + removed + ' common items.'); }
init(); requestAnimationFrame(gameLoop);
canvas.addEventListener('click',(e)=>{ if(e.clientY < 80) return; state.enemies.push(new Enemy(e.clientX+rand(-40,40), e.clientY+rand(-40,40), Math.floor(rand(1,3)))); });
const origPush = state.gearOwned.push.bind(state.gearOwned); state.gearOwned.push = function(item){ Array.prototype.push.call(this,item); if(state.player.weapon==null || item.rarity==='legendary' || item.rarity==='epic'){ state.player.equip(item); } updateUI(); };
})();
</script>
</body>
</html>